# 导演决策返回格式说明

## 概述

导演评估器（DirectorEvaluator）要求LLM以JSON格式返回决策结果，包含事件触发、怪物出现、场景转换和时间消耗等信息。

## JSON返回格式

```json
{
    "trigger_event": "event_001",
    "event_description": "年长的村民注意到你，走过来向你求助：\"冒险者，我们的田野被魔物侵扰，庄稼被毁，村民们都不敢去田里了。你能帮我们清剿这些魔物吗？我们会给予报酬的。\"",
    "appear_monster": null,
    "monster_description": "",
    "transition_target": "scene_002",
    "transition_type": "scene",
    "elapsed_time": 5.0,
    "reasoning": "玩家表现出帮助意愿，且已满足事件触发条件，应该触发接受任务事件并引导玩家前往田野"
}
```

## 字段说明

### trigger_event
- **类型**: `string | null`
- **说明**: 触发的事件ID
- **格式**: 必须使用事件ID（如 `"event_001"` 或 `"random_001"`），不要使用事件名称
- **示例**: 
  - `"event_001"` - 触发核心事件
  - `"random_001"` - 触发随机事件
  - `null` - 不触发事件

### event_description
- **类型**: `string`
- **说明**: 事件描述文本，用于向玩家展示
- **要求**: 如果触发事件，必须提供描述；如果不触发事件，可以为空字符串
- **示例**: `"年长的村民注意到你，走过来向你求助：\"冒险者，我们的田野被魔物侵扰...\""`

### appear_monster
- **类型**: `string | null`
- **说明**: 出现的怪物名称
- **格式**: 使用怪物名称（如 `"田野魔物"`）
- **示例**: 
  - `"田野魔物"` - 怪物出现
  - `null` - 不出现怪物

### monster_description
- **类型**: `string`
- **说明**: 怪物出现描述文本，用于向玩家展示
- **要求**: 如果怪物出现，必须提供描述；如果不出现，可以为空字符串
- **示例**: `"突然，你听到前方传来低沉的咆哮声。一只巨大的魔物从庄稼中冲了出来！"`

### transition_target
- **类型**: `string | null`
- **说明**: 目标场景或房间ID
- **格式**: 使用场景ID（如 `"scene_002"`）或房间ID（如 `"room_002_001"`）
- **要求**: 必须从可连接目标列表中选择，不能跳转到未连接的场景
- **示例**: 
  - `"scene_002"` - 转换到场景
  - `"room_002_001"` - 转换到房间
  - `null` - 不转换场景/房间

### transition_type
- **类型**: `string`
- **说明**: 转换类型
- **可选值**: 
  - `"scene"` - 转换到一级场景
  - `"room"` - 转换到二级场景（房间）
- **要求**: 必须与transition_target的类型匹配

### elapsed_time
- **类型**: `number` (float)
- **说明**: 本次操作消耗的游戏内时间（单位：分钟）
- **范围**: 通常在 1-30 分钟之间
- **要求**: **必须提供**，不能为null或0
- **时间消耗参考**:
  - 简单对话/观察：1-3分钟
  - 探索/调查：3-10分钟
  - 战斗：5-15分钟
  - 场景转换：2-5分钟
  - 复杂操作：10-30分钟
- **示例**: `5.0` (表示消耗5分钟游戏内时间)

### reasoning
- **类型**: `string`
- **说明**: 决策理由（隐藏，用于调试）
- **要求**: 应该简要说明为什么做出这个决策
- **示例**: `"玩家表现出帮助意愿，且已满足事件触发条件，应该触发接受任务事件并引导玩家前往田野"`

## 完整示例

### 示例1：触发事件并转换场景
```json
{
    "trigger_event": "event_001",
    "event_description": "年长的村民注意到你，走过来向你求助：\"冒险者，我们的田野被魔物侵扰，庄稼被毁，村民们都不敢去田里了。你能帮我们清剿这些魔物吗？我们会给予报酬的。\"",
    "appear_monster": null,
    "monster_description": "",
    "transition_target": "scene_002",
    "transition_type": "scene",
    "elapsed_time": 5.0,
    "reasoning": "玩家表现出帮助意愿，触发接受任务事件，引导前往田野"
}
```

### 示例2：触发随机事件（遭遇怪物）
```json
{
    "trigger_event": "random_003",
    "event_description": "突然，你听到前方传来低沉的咆哮声。一只巨大的魔物从庄稼中冲了出来！",
    "appear_monster": "田野魔物",
    "monster_description": "它有着锋利的爪子和凶狠的眼神，显然把你当作了猎物。",
    "transition_target": null,
    "transition_type": "scene",
    "elapsed_time": 12.0,
    "reasoning": "玩家深入田野，满足随机遭遇条件，触发战斗事件"
}
```

### 示例3：不触发任何事件
```json
{
    "trigger_event": null,
    "event_description": "",
    "appear_monster": null,
    "monster_description": "",
    "transition_target": null,
    "transition_type": "scene",
    "elapsed_time": 2.0,
    "reasoning": "玩家只是简单观察，不需要触发事件"
}
```

## 注意事项

1. **事件ID格式**: 必须使用事件ID（如 `"event_001"`），不要使用事件名称
2. **时间消耗**: `elapsed_time` 必须提供，且应该在合理范围内（1-30分钟）
3. **场景转换**: `transition_target` 必须从可连接目标列表中选择
4. **类型匹配**: `transition_type` 必须与 `transition_target` 的类型匹配
5. **核心事件**: 只有核心事件可以触发场景转换，随机事件不能触发场景转换
6. **前置条件**: 必须检查事件和场景转换的前置条件是否满足

## 时间系统说明

- 游戏内时间独立于现实时间
- 每次操作都会消耗一定的游戏内时间
- 时间消耗会影响事件触发条件（如"在场景中停留超过5分钟"）
- 时间管理器会跟踪游戏内时间，并更新场景状态

